<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Video Slicer — Prototype</title>
    <!-- CSP simple : tout en local -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; media-src 'self' file:; style-src 'self'"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body
    class="min-h-screen p-4 font-sans text-text bg-[radial-gradient(1200px_800px_at_10%_10%,#182033_0%,#0b0f14_55%),radial-gradient(1000px_700px_at_90%_20%,#1b1222_0%,#0b0f14_60%)]"
  >
    <header
      class="fixed left-8 top-8 z-20 rounded-lg border border-white/10 bg-black/60 px-3 py-1 backdrop-blur"
    >
      <h1 class="m-0">
        <img
          src="./logo.png"
          alt=""
          id="logo"
          class="w-[92px] align-middle drop-shadow-[0_6px_16px_rgba(0,0,0,0.4)]"
        />
      </h1>
    </header>

    <main class="flex flex-col gap-3">
      <!-- MAIN PANELS -->
      <div class="flex items-stretch gap-4">
        <!-- VIDEO PANEL -->
        <div class="grow relative">
          <video
            id="video"
            preload="metadata"
            playsinline
            class="h-[65vh] w-full rounded-2xl border border-white/10 bg-[#05070a] object-contain shadow-[0_20px_50px_rgba(0,0,0,0.35),0_0_40px_rgba(100,243,210,0.08)]"
          ></video>
          <div
            class="absolute w-full bottom-0 left-0 bg-gray-900/70 p-3 flex justify-between"
          >
            <div>
              <span class="flex-1"></span>
              <span id="fps" class="muted">fps ≈ n/a</span>
              <span id="time" class="time text-3xl">00:00:00.000</span>
            </div>
            <div class="flex flex-wrap items-center gap-3">
              <label class="flex items-center gap-2">
                Vitesse
                <select id="rate" class="input">
                  <option>0.25</option>
                  <option>0.5</option>
                  <option selected>1</option>
                  <option>1.25</option>
                  <option>1.5</option>
                  <option>2</option>
                  <option>4</option>
                </select>
              </label>
              <button
                id="playToggle"
                class="btn btn-icon btn-media"
                aria-label="Play/Pause"
              >
                <svg
                  width="22"
                  height="22"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path d="M8 5v14l11-7z" fill="currentColor" />
                </svg>
              </button>
              <button
                id="loopToggle"
                class="btn btn-icon btn-media secondary"
                aria-label="Loop"
              >
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    d="M3 12a9 9 0 0 1 15.5-6.36"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <path
                    d="M18.5 3.5v4.5H14"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M21 12a9 9 0 0 1-15.5 6.36"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <path
                    d="M5.5 20.5V16H10"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- CONTROLS PANELS -->
        <div
          class="flex min-w-[320px] max-w-[420px] flex-col gap-3 overflow-auto justify-between"
        >
          <div class="flex flex-col gap-3">
            <div class="flex flex-wrap items-start gap-3">
              <div class="panel flex-1 animate-floatIn">
                <div class="section-title">Fichier</div>
                <div class="flex flex-wrap items-center gap-3">
                  <button id="openFile" class="btn">Ouvrir une vidéo…</button>
                  <span class="muted"
                    >Formats courants : mp4, mkv, mov, avi, webm</span
                  >
                </div>
              </div>
            </div>
          </div>

          <div class="flex flex-col gap-3">
            <div class="panel animate-floatIn">
              <div class="section-title">Tempo/Pitch</div>
              <div class="flex flex-wrap items-center gap-3">
                <label class="flex items-center gap-2">
                  Mesures
                  <input
                    id="bars"
                    type="number"
                    min="1"
                    step="1"
                    value="1"
                    class="input w-[90px]"
                  />
                </label>
                <label class="flex items-center gap-2">
                  Signature
                  <select id="beatsPerBar" class="input">
                    <option value="4">4/4</option>
                    <option value="3">3/4</option>
                    <option value="2">2/4</option>
                    <option value="6">6/8</option>
                  </select>
                </label>
                <span class="muted"
                  >Durée loop: <span id="loopLen">--:--:--.---</span></span
                >
                <span class="muted"
                  >BPM actuel: <span id="bpmComputed">--</span></span
                >
                <label class="flex items-center gap-2">
                  BPM cible
                  <input
                    id="bpmTarget"
                    type="number"
                    min="1"
                    step="0.1"
                    class="input w-[110px]"
                  />
                </label>
                <label class="flex items-center gap-2">
                  <input id="keepPitch" type="checkbox" checked />
                  Maintenir le pitch
                </label>
                <div class="flex flex-wrap items-center gap-3">
                  <label class="flex items-center gap-2">
                    Pitch (demi-tons)
                    <input
                      id="pitchSemis"
                      type="range"
                      min="-12"
                      max="12"
                      step="1"
                      value="0"
                      class="range"
                    />
                    <span id="pitchSemisVal" class="muted">0</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="panel animate-floatIn">
              <div class="section-title">Loop IN/OUT</div>
              <div class="flex flex-wrap items-center gap-3">
                <div class="flex items-center gap-2">
                  <button id="setStart" class="btn w-32 text-left">
                    Set Start <span class="text-xs">[⌘1]</span>
                  </button>
                  <input
                    id="startInput"
                    type="number"
                    min="0"
                    step="0.001"
                    placeholder="--:--:--.---"
                    class="input grow"
                  />
                </div>
                <div class="flex items-center gap-2">
                  <button id="setEnd" class="btn w-32 text-left">
                    Set End <span class="text-xs">[⌘2]</span>
                  </button>
                  <input
                    id="endInput"
                    type="number"
                    min="0"
                    step="0.001"
                    placeholder="--:--:--.---"
                    class="input grow"
                  />
                </div>
                <!-- EXPORT CTA -->
                <div>
                  <button id="exportClip" class="btn cta mt-3">
                    Exporter extrait
                  </button>
                  <span id="exportStatus" class="muted"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- TIMELINES -->
      <div class="w-full">
        <!-- Barre de défilement -->
        <div class="panel panel-alt animate-floatIn">
          <input
            id="seek"
            type="range"
            min="0"
            max="0"
            step="0.001"
            value="0"
            class="range w-full"
          />
          <div class="mt-2 text-xs text-muted">
            Position: <span id="posDisplay">00:00:00.000</span> /
            <span id="durDisplay">--:--:--.---</span>
          </div>
        </div>

        <!-- Timeline simple (loop + zoom + handles) -->
        <div class="panel panel-alt animate-floatIn mt-3">
          <div class="flex flex-wrap items-center gap-3">
            <div class="flex-1">
              <div id="timeline" class="timeline">
                <div id="tlRange" class="tl-range" hidden></div>
                <div id="tlStartHandle" class="tl-handle" hidden></div>
                <div id="tlEndHandle" class="tl-handle" hidden></div>
                <div id="tlPlayhead" class="tl-playhead"></div>
              </div>
            </div>
            <div class="min-w-[220px]">
              <div class="text-xs text-muted">
                Zoom
                <input
                  id="tlZoom"
                  type="range"
                  min="1"
                  max="100"
                  step="0.5"
                  value="1"
                  class="range mt-1"
                />
                <span id="tlZoomVal">1x</span>
              </div>
              <div class="mt-2 text-xs text-muted">
                Fenêtre:
                <span id="tlWindow">--:--:--.--- – --:--:--.---</span>
              </div>
            </div>
          </div>
          <div class="mt-2 text-xs text-muted">
            Glissez les poignées pour régler IN/OUT. Cliquez pour déplacer la
            tête de lecture.
          </div>
        </div>
      </div>
    </main>
    <footer class="mt-6 text-xs opacity-30 absolute bottom-4 center">
      &copy;VIDEO SLICER 2026
    </footer>

    <script type="module" src="./app.js"></script>
  </body>
</html>
