<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Video Cutter — Prototype</title>
    <!-- CSP simple : tout en local -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; media-src 'self' file:; style-src 'self' 'unsafe-inline'"
    />
    <style>
      :root {
        --gap: 12px;
        --bg: #0b0f14;
        --panel: #111722;
        --panel-2: #0f151f;
        --stroke: #1f2a3a;
        --text: #e7edf7;
        --muted: #9aa6b2;
        --accent: #64f3d2;
        --accent-2: #ff6b6b;
        --cta: #ffd166;
        --glow: rgba(100, 243, 210, 0.25);
      }
      * {
        box-sizing: border-box;
      }

      /* ===== Layout global (respecte vos couleurs) ===== */
      html {
        height: 100%;
      }
      body {
        font-family: "Space Grotesk", "Sora", "Segoe UI", sans-serif;
        padding: 16px;
        background: radial-gradient(1200px 800px at 10% 10%, #182033 0%, #0b0f14 55%),
          radial-gradient(1000px 700px at 90% 20%, #1b1222 0%, #0b0f14 60%);
        color: var(--text);
        height: 100vh; /* plein écran */
        min-height: 0;
        /* overflow: hidden; évite scroll parasite si la vidéo déborde */
      }

      h1 {
        margin: 0;
      }

      .row {
        display: flex;
        gap: var(--gap);
        align-items: top;
        flex-wrap: wrap;
      }

      .box {
        padding: 12px;
        border: 1px solid var(--stroke);
        border-radius: 12px;
        margin-bottom: 12px;
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), transparent);
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2),
          0 10px 30px rgba(0, 0, 0, 0.25);
      }

      .section-title {
        font-size: 12px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin-bottom: 8px;
      }

      .cta {
        background: linear-gradient(120deg, #ffd166, #ffb703);
        color: #0b0f14;
        font-weight: 600;
        box-shadow: 0 0 0 1px rgba(255, 209, 102, 0.2),
          0 10px 24px rgba(255, 209, 102, 0.2);
      }

      .layout {
        display: grid;
        grid-template-columns: 1.3fr 380px;
        grid-template-rows: 65vh auto;
        gap: 16px;
        height: calc(100vh - 32px);
        min-height: 0;
        align-items: start;
      }

      .logo-block {
        position: fixed;
        top: .5em;
        left: .5em;
        z-index: 20;
        padding: 6px 10px;
        border-radius: 10px;
        background: rgba(10, 14, 20, 0.6);
        backdrop-filter: blur(6px);
        border: 1px solid rgba(255, 255, 255, 0.06);
      }

      .video-wrap {
        grid-column: 1;
        grid-row: 1;
        min-width: 0;
      }

      .right {
        grid-column: 2;
        grid-row: 1;
        max-width: 420px;
        min-width: 320px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        height: 65vh; /* aligné sur la fenêtre vidéo */
        overflow: auto;
      }

      .bottom {
        grid-column: 1 / -1;
        grid-row: 2;
        width: 100%;
      }

      #video {
        width: 100%;
        height: 65vh;
        object-fit: contain; /* bandes noires si nécessaire, pas d’étirement */
        background: #05070a;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.35),
          0 0 40px rgba(100, 243, 210, 0.08);
        /* pas de max-height ici: ça bloquait la croissance */
      }

      /* Boutons & selects: vos couleurs */
      button,
      select,
      input {
        padding: 6px 10px;
        background: #141b27;
        color: var(--text);
        border: 1px solid var(--stroke);
        border-radius: 8px;
        outline: none;
        transition: transform 120ms ease, box-shadow 160ms ease, border 120ms ease,
          background 120ms ease;
      }

      button {
        cursor: pointer;
      }

      button:hover,
      select:hover,
      input:hover {
        border-color: rgba(100, 243, 210, 0.5);
        box-shadow: 0 0 0 3px var(--glow);
      }

      button:active {
        transform: translateY(1px);
      }

      .grow {
        flex: 1;
      }

      .time {
        font-variant-numeric: tabular-nums;
        min-width: 160px;
        text-align: right;
      }

      .kbd {
        padding: 2px 6px;
        border: 1px solid #999;
        border-radius: 4px;
        background: #d0d0d0;
        color: #000;
        font-family: ui-monospace, SFMono-Regular, monospace;
      }

      .small {
        color: var(--muted);
        font-size: 12px;
      }

      /* Logo: inchangé */
      #logo {
        width: 92px;
        vertical-align: middle;
        filter: drop-shadow(0 6px 16px rgba(0, 0, 0, 0.4));
      }

      /* ===== Seekbar (cliquable, avec surlignage IN/OUT via --seek-bg) ===== */
      #seek {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 8px;
        border-radius: 6px;
        background: #0f1621;
        outline: none;
        position: relative;
        z-index: 10; /* au-dessus de la vidéo si besoin */
      }

      #seek::-webkit-slider-runnable-track {
        height: 8px;
        border-radius: 6px;
        background: var(--seek-bg, #1b2432);
      }

      #seek::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: var(--accent);
        border: 2px solid #0b0f14;
        margin-top: -3px; /* centre le thumb sur la piste (8px) */
        box-shadow: 0 0 12px rgba(100, 243, 210, 0.6);
      }

      /* (Optionnel) Compat Firefox, au cas où */
      #seek::-moz-range-track {
        height: 8px;
        border-radius: 6px;
        background: var(--seek-bg, #1b2432);
      }
      #seek::-moz-range-thumb {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: var(--accent);
        border: 2px solid #0b0f14;
      }

      /* ===== Timeline simple (loop + zoom) ===== */
      .timeline {
        position: relative;
        height: 42px;
        background: #0f1621;
        border-radius: 6px;
        overflow: hidden;
      }

      .tl-range {
        position: absolute;
        top: 0;
        bottom: 0;
        background: linear-gradient(90deg, rgba(100, 243, 210, 0.2), rgba(100, 243, 210, 0.45));
      }

      .tl-handle {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 6px;
        background: var(--accent);
        cursor: ew-resize;
        box-shadow: 0 0 8px rgba(100, 243, 210, 0.6);
      }

      .tl-playhead {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 2px;
        background: var(--accent-2);
        opacity: 0.9;
        pointer-events: none;
        box-shadow: 0 0 10px rgba(255, 107, 107, 0.6);
      }

      .timeline-meta {
        min-width: 220px;
      }

      .row > .cta {
        height: 40px;
        padding: 8px 16px;
      }

      .bottom .box {
        background: var(--panel-2);
      }

      .right .box {
        background: var(--panel);
      }

      @keyframes floatIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .right .box,
      .bottom .box {
        animation: floatIn 420ms ease both;
      }

      .right .box:nth-child(1) {
        animation-delay: 40ms;
      }
      .right .box:nth-child(2) {
        animation-delay: 80ms;
      }
      .right .box:nth-child(3) {
        animation-delay: 120ms;
      }
      .right .box:nth-child(4) {
        animation-delay: 160ms;
      }
      .right .box:nth-child(5) {
        animation-delay: 200ms;
      }
    </style>
  </head>
  <body>
    <div class="logo-block">
      <h1>
        <img src="./logo.png" alt="" id="logo" />
      </h1>
    </div>

    <div class="layout">
      <div class="video-wrap">
        <!-- Lecteur vidéo -->
        <video id="video" preload="metadata" playsinline></video>
      </div>

      <div class="right">
        <div class="row">
          <div class="box grow">
            <div class="section-title">Fichier</div>
            <div class="row">
              <button id="openFile">Ouvrir une vidéo…</button>
              <span class="small"
                >Formats courants : mp4, mkv, mov, avi, webm</span
              >
            </div>
          </div>
          <button id="exportClip" class="cta">Exporter extrait</button>
          <span id="exportStatus" class="small"></span>
        </div>

        <div class="box">
          <div class="section-title">Lecture</div>
          <div class="row">
            <button id="playToggle">▶︎ Play</button>
            <button id="loopToggle">Loop: OFF</button>
            <label
              >Vitesse
              <select id="rate">
                <option>0.25</option>
                <option>0.5</option>
                <option selected>1</option>
                <option>1.25</option>
                <option>1.5</option>
                <option>2</option>
                <option>4</option></select
              >
            </label>
            <span class="grow"></span>
            <span id="fps" class="small">fps ≈ n/a</span>
            <span id="time" class="time">00:00:00.000</span>
          </div>
          <div class="row">
            <label
              >Pitch (demi-tons)
              <input
                id="pitchSemis"
                type="range"
                min="-12"
                max="12"
                step="1"
                value="0"
              />
              <span id="pitchSemisVal">0</span>
            </label>
          </div>
        </div>

        <div class="box">
          <div class="section-title">Loop IN/OUT</div>
          <div class="row">
            
            
            <div>
              <button id="setStart">Set Start</button>
        
              <input id="startInput" type="number" min="0" step="0.001" placeholder="--:--:--.---" />
        
            </div>
            
            <div>
              <button id="setEnd">Set End&nbsp;</button>
           
              <input id="endInput" type="number" min="0" step="0.001" placeholder="--:--:--.---" />
           
            </div>
            
          </div>
        </div>

        <div class="box">
          <div class="section-title">Tempo</div>
          <div class="row">
            <label
              >Mesures
              <input id="bars" type="number" min="1" step="1" value="1" />
            </label>
            <label
              >
              <select id="beatsPerBar">
                <option value="4">4/4</option>
                <option value="3">3/4</option>
                <option value="2">2/4</option>
                <option value="6">6/8</option>
              </select>
            </label>
            <span class="small"
              >Durée loop: <span id="loopLen">--:--:--.---</span></span
            >
            <span class="small"
              >BPM actuel: <span id="bpmComputed">--</span></span
            >
            <label
              >BPM cible
              <input id="bpmTarget" type="number" min="1" step="0.1" />
            </label>
            <label
              ><input id="keepPitch" type="checkbox" checked /> Maintenir le
              pitch</label
            >
          </div>
        </div>
      </div>
      <div class="bottom">
      <!-- Barre de défilement -->
      <div class="box">
        <input
          id="seek"
          type="range"
          min="0"
          max="0"
          step="0.001"
          value="0"
          style="width: 100%"
        />
        <div class="small">
          Position: <span id="posDisplay">00:00:00.000</span> /
          <span id="durDisplay">--:--:--.---</span>
        </div>
      </div>

      <!-- Timeline simple (loop + zoom + handles) -->
      <div class="box">
        <div class="row">
          <div class="grow">
            <div id="timeline" class="timeline">
              <div id="tlRange" class="tl-range" hidden></div>
              <div id="tlStartHandle" class="tl-handle" hidden></div>
              <div id="tlEndHandle" class="tl-handle" hidden></div>
              <div id="tlPlayhead" class="tl-playhead"></div>
            </div>
          </div>
          <div class="timeline-meta">
            <div class="small">
              Zoom
              <input
                id="tlZoom"
                type="range"
                min="1"
                max="60"
                step="0.5"
                value="1"
              />
              <span id="tlZoomVal">1x</span>
            </div>
            <div class="small">
              Fenêtre:
              <span id="tlWindow">--:--:--.--- – --:--:--.---</span>
            </div>
          </div>
        </div>
        <div class="small">
          Glissez les poignées pour régler IN/OUT. Cliquez pour déplacer la
          tête de lecture.
        </div>
      </div>
    </div>
      </div>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>
